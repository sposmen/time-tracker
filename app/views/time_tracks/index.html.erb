<p id="notice"><%= notice %></p>

<h1>Time Track</h1>

<div class="row">
<%= render 'start', time_track: @time_track %>
</div>

<table class="table table-striped">
  <thead>
  <tr>
    <th>Description</th>
    <th>Start at</th>
    <th>End at</th>
    <th>Current time</th>
    <th colspan="3"></th>
  </tr>
  </thead>

  <tbody>

  <%
    total_time = 0.seconds
    auto_reload = false
    @time_tracks.each do |time_track|
      auto_reload ||= time_track.end_at.nil?
      current_time = (time_track.end_at || Time.current) - time_track.start_at
      total_time += current_time
  %>
    <tr class="table-<%= time_track.end_at.nil? ? 'danger' : 'success' %>">
      <td><%= time_track.description %></td>
      <td><%= l time_track.start_at.in_time_zone(-5), format: '%F %I:%M%p' %></td>
      <td><%= l time_track.end_at.in_time_zone(-5), format: '%F %I:%M%p' if time_track.end_at %></td>
      <td><%= (current_time / (3600)).round(2) %></td>
      <td><%= link_to 'Edit', edit_time_track_path(time_track), class: 'btn btn-secondary btn-sm' %></td>
      <% if !time_track.end_at.nil? %>
        <td><%= link_to 'Duplicate', time_track_duplicate_path(time_track), class: 'btn btn-warning btn-sm' %></td>
      <% else %>
        <td><%= link_to 'Stop', time_track_stop_path(time_track), class: 'btn btn-danger btn-sm' %></td>
      <% end %>
      <!--            <td><%#= link_to 'Destroy', time_track, method: :delete, data: { confirm: 'Are you sure?' } %></td>-->
    </tr>
  <% end %>
  <tr>
    <th colspan="3">Total Time</th>
    <th><%= (total_time / (3600)).round(2) %> Hours</th>
    <th colspan="2"></th>
  </tr>
  </tbody>
</table>
<br>
<%= link_to 'New Time Track', new_time_track_path %>
<% if auto_reload %>
  <script>
    setTimeout(() => window.location.reload(), 60 * 1000)
  </script>
<% end %>
